<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSE-Trainer Master</title>
    <style>
        :root {
            --primary: #2563eb; --primary-dark: #1e40af; --success: #22c55e; --error: #ef4444;
            --bg-site: #f8fafc; --bg-card: #ffffff; --border: #e2e8f0; --text-main: #1e293b; --text-muted: #64748b;
            --alkali: #fee2e2; --erdalkali: #ffedd5; --halogene: #dcfce7; --edelgase: #f3e8ff;
            --nichtmetalle: #e0f2fe; --metalle: #f1f5f9; --halbmetalle: #fef9c3;
        }

        * { box-sizing: border-box; transition: all 0.1s ease; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-site); color: var(--text-main); padding: 20px; display: flex; justify-content: center; }
        .pse-container { max-width: 1000px; width: 100%; background: var(--bg-card); border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid var(--border); padding: 24px; }
        header { border-bottom: 2px solid var(--border); margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .stats-bar { display: flex; gap: 15px; background: var(--bg-site); padding: 8px 16px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; background: #f1f5f9; padding: 15px; border-radius: 8px; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.8rem; font-weight: 600; color: var(--text-muted); }
        .task-area { background: var(--primary); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; }
        #task-text { font-size: 1.1rem; font-weight: 500; margin: 0; }
        #feedback { font-weight: 700; margin-top: 8px; min-height: 1.2rem; }
        .ptable { display: grid; grid-template-columns: 35px repeat(8, 1fr); gap: 5px; min-width: 800px; margin-top: 10px; }
        .cell { aspect-ratio: 1 / 1; border: 1px solid var(--border); border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; cursor: pointer; background: white; font-size: 0.75rem; }
        .cell.header { background: none; border: none; font-weight: bold; cursor: default; color: var(--text-muted); }
        .cell.empty { background: none; border: none; cursor: default; }
        .z-num { position: absolute; top: 2px; left: 4px; font-size: 0.6rem; color: var(--text-muted); }
        .symbol { font-size: 1.1rem; font-weight: bold; }
        .name { font-size: 0.55rem; text-align: center; margin-top: 2px; }

        /* Kategorien */
        .alkali { background: var(--alkali); } .erdalkali { background: var(--erdalkali); }
        .halogen { background: var(--halogene); } .edelgas { background: var(--edelgase); }
        .nichtmetall { background: var(--nichtmetalle); } .metall { background: var(--metalle); } .halbmetall { background: var(--halbmetalle); }

        /* Sichtbarkeit */
        .content-hidden .symbol, .content-hidden .name, .content-hidden .z-num { visibility: hidden !important; }
        .cell.correct { background: var(--success) !important; color: white; }
        .cell.wrong { background: var(--error) !important; color: white; }
        .cell.target-frame { border: 4px solid #facc15 !important; box-shadow: 0 0 10px rgba(250,204,21,0.5); z-index: 5; }
        .cell.highlight { border: 3px solid var(--primary); }

        .input-area { display: none; gap: 10px; margin-top: 20px; justify-content: center; }
        input { padding: 10px; border: 2px solid var(--primary); border-radius: 8px; outline: none; width: 200px; }
        button { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .deck-info { font-size: 0.75rem; color: var(--text-muted); margin-top: 10px; text-align: center; }
    </style>
</head>
<body>

<div class="pse-container">
    <header>
        <h1>PSE-Trainer</h1>
        <div class="stats-bar">
            <div>Richtig: <span id="score">0</span></div>
            <div>Stapel: <span id="remaining">42</span></div>
            <div>Gesamt: <span id="total">0</span></div>
        </div>
    </header>

    <div class="controls">
        <div class="control-group">
            <label>Modus</label>
            <select id="mode-select">
                <option value="click">1Ô∏è‚É£ Position finden (Klicken)</option>
                <option value="input">2Ô∏è‚É£ Symbol/Name eingeben</option>
                <option value="identify">3Ô∏è‚É£ Position gegeben (Symbol gesucht)</option>
                <option value="study">üìñ Lernmodus</option>
            </select>
        </div>
        <div class="control-group">
            <label>Optionen</label>
            <div>
                <input type="checkbox" id="show-others" checked> <label for="show-others">Andere Elemente zeigen</label>
            </div>
        </div>
        <div class="control-group">
            <label>&nbsp;</label>
            <button id="next-btn">N√§chste Aufgabe</button>
        </div>
    </div>

    <div class="task-area">
        <p id="task-text">W√§hle einen Modus und starte die Aufgabe.</p>
        <div id="feedback"></div>
    </div>

    <div style="overflow-x:auto;">
        <div id="ptable" class="ptable"></div>
    </div>

    <div class="input-area" id="input-container">
        <input type="text" id="answer-input" placeholder="Antwort..." autocomplete="off">
        <button id="submit-btn">Pr√ºfen</button>
    </div>
    <p class="deck-info">Die Elemente werden gemischt. Keine Wiederholung, bis der Stapel leer ist.</p>
</div>

<script>
    const elements = [
        { z: 1, s: "H", n: "Wasserstoff", g: 1, p: 1, c: "nichtmetall" }, { z: 2, s: "He", n: "Helium", g: 18, p: 1, c: "edelgas" },
        { z: 3, s: "Li", n: "Lithium", g: 1, p: 2, c: "alkali" }, { z: 4, s: "Be", n: "Beryllium", g: 2, p: 2, c: "erdalkali" },
        { z: 5, s: "B", n: "Bor", g: 13, p: 2, c: "halbmetall" }, { z: 6, s: "C", n: "Kohlenstoff", g: 14, p: 2, c: "nichtmetall" },
        { z: 7, s: "N", n: "Stickstoff", g: 15, p: 2, c: "nichtmetall" }, { z: 8, s: "O", n: "Sauerstoff", g: 16, p: 2, c: "nichtmetall" },
        { z: 9, s: "F", n: "Fluor", g: 17, p: 2, c: "halogen" }, { z: 10, s: "Ne", n: "Neon", g: 18, p: 2, c: "edelgas" },
        { z: 11, s: "Na", n: "Natrium", g: 1, p: 3, c: "alkali" }, { z: 12, s: "Mg", n: "Magnesium", g: 2, p: 3, c: "erdalkali" },
        { z: 13, s: "Al", n: "Aluminium", g: 13, p: 3, c: "metall" }, { z: 14, s: "Si", n: "Silicium", g: 14, p: 3, c: "halbmetall" },
        { z: 15, s: "P", n: "Phosphor", g: 15, p: 3, c: "nichtmetall" }, { z: 16, s: "S", n: "Schwefel", g: 16, p: 3, c: "nichtmetall" },
        { z: 17, s: "Cl", n: "Chlor", g: 17, p: 3, c: "halogen" }, { z: 18, s: "Ar", n: "Argon", g: 18, p: 3, c: "edelgas" },
        { z: 19, s: "K", n: "Kalium", g: 1, p: 4, c: "alkali" }, { z: 20, s: "Ca", n: "Calcium", g: 2, p: 4, c: "erdalkali" },
        { z: 31, s: "Ga", n: "Gallium", g: 13, p: 4, c: "metall" }, { z: 32, s: "Ge", n: "Germanium", g: 14, p: 4, c: "halbmetall" },
        { z: 33, s: "As", n: "Arsen", g: 15, p: 4, c: "halbmetall" }, { z: 34, s: "Se", n: "Selen", g: 16, p: 4, c: "nichtmetall" },
        { z: 35, s: "Br", n: "Brom", g: 17, p: 4, c: "halogen" }, { z: 36, s: "Kr", n: "Krypton", g: 18, p: 4, c: "edelgas" },
        { z: 37, s: "Rb", n: "Rubidium", g: 1, p: 5, c: "alkali" }, { z: 38, s: "Sr", n: "Strontium", g: 2, p: 5, c: "erdalkali" },
        { z: 49, s: "In", n: "Indium", g: 13, p: 5, c: "metall" }, { z: 50, s: "Sn", n: "Zinn", g: 14, p: 5, c: "metall" },
        { z: 51, s: "Sb", n: "Antimon", g: 15, p: 5, c: "halbmetall" }, { z: 52, s: "Te", n: "Tellur", g: 16, p: 5, c: "halbmetall" },
        { z: 53, s: "I", n: "Iod", g: 17, p: 5, c: "halogen" }, { z: 54, s: "Xe", n: "Xenon", g: 18, p: 5, c: "edelgas" },
        { z: 55, s: "Cs", n: "C√§sium", g: 1, p: 6, c: "alkali" }, { z: 56, s: "Ba", n: "Barium", g: 2, p: 6, c: "erdalkali" },
        { z: 81, s: "Tl", n: "Thallium", g: 13, p: 6, c: "metall" }, { z: 82, s: "Pb", n: "Blei", g: 14, p: 6, c: "metall" },
        { z: 83, s: "Bi", n: "Bismut", g: 15, p: 6, c: "metall" }, { z: 84, s: "Po", n: "Polonium", g: 16, p: 6, c: "halbmetall" },
        { z: 85, s: "At", n: "Astat", g: 17, p: 6, c: "halbmetall" }, { z: 86, s: "Rn", n: "Radon", g: 18, p: 6, c: "edelgas" }
    ];

    const groups = [1, 2, 13, 14, 15, 16, 17, 18];
    let deck = [], currentTask = null, score = 0, total = 0;

    function initTable() {
        const ptable = document.getElementById('ptable');
        ptable.innerHTML = '';
        const header = document.createElement('div'); header.className='cell header'; header.innerText='P/G'; ptable.appendChild(header);
        groups.forEach(g => { const c=document.createElement('div'); c.className='cell header'; c.innerText=g; ptable.appendChild(c); });

        for (let p = 1; p <= 6; p++) {
            const ph = document.createElement('div'); ph.className='cell header'; ph.innerText=p; ptable.appendChild(ph);
            groups.forEach(g => {
                const el = elements.find(e => e.p === p && e.g === g);
                const cell = document.createElement('div');
                if (el) {
                    cell.className = `cell ${el.c} content-hidden`;
                    cell.id = `el-${el.z}`;
                    cell.innerHTML = `<span class="z-num">${el.z}</span><span class="symbol">${el.s}</span><span class="name">${el.n}</span>`;
                    cell.onclick = () => handleCellClick(el);
                } else { cell.className = 'cell empty'; }
                ptable.appendChild(cell);
            });
        }
    }

    function refreshDeck() {
        deck = [...elements];
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    function updateVisibility() {
        const others = document.getElementById('show-others').checked;
        elements.forEach(el => {
            const cell = document.getElementById(`el-${el.z}`);
            // Grundregel: Verstecke das Ziel-Element IMMER w√§hrend der Aufgabe
            if (currentTask && el.z === currentTask.z) {
                cell.classList.add('content-hidden');
            } else if (others || !currentTask) {
                cell.classList.remove('content-hidden');
            } else {
                cell.classList.add('content-hidden');
            }
        });
    }

    function nextTask() {
        if (deck.length === 0) refreshDeck();
        currentTask = deck.pop();
        document.getElementById('remaining').innerText = deck.length;
        
        // Reset Styles
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('correct', 'wrong', 'target-frame', 'highlight'));
        document.getElementById('feedback').innerText = '';
        document.getElementById('answer-input').value = '';
        
        const mode = document.getElementById('mode-select').value;
        const inputArea = document.getElementById('input-container');

        if (mode === 'click') {
            inputArea.style.display = 'none';
            taskText.innerText = `Suche die Position von: ${currentTask.n} (${currentTask.s})`;
        } else if (mode === 'input') {
            inputArea.style.display = 'flex';
            document.getElementById(`el-${currentTask.z}`).classList.add('highlight');
            taskText.innerText = `Welches Element geh√∂rt in das markierte Feld? (Symbol oder Name)`;
            document.getElementById('answer-input').focus();
        } else if (mode === 'identify') {
            inputArea.style.display = 'flex';
            document.getElementById(`el-${currentTask.z}`).classList.add('target-frame');
            taskText.innerText = `Welches Symbol geh√∂rt in das umrahmte Feld?`;
            document.getElementById('answer-input').focus();
        } else {
            inputArea.style.display = 'none';
            taskText.innerText = "Lernmodus: Klicke auf die Felder.";
            currentTask = null; // Im Lernmodus keine aktive Aufgabe
        }
        updateVisibility();
    }

    function handleCellClick(el) {
        const mode = document.getElementById('mode-select').value;
        if (mode === 'study') {
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('highlight'));
            document.getElementById(`el-${el.z}`).classList.add('highlight');
            taskText.innerText = `${el.n} (${el.s}): Ordnungszahl ${el.z}, Hauptgruppe ${groups.indexOf(el.g)+1}`;
        } else if (mode === 'click' && currentTask) {
            validate(el.z === currentTask.z, el.z);
        }
    }

    function validate(isCorrect, clickedZ = null) {
        if (!currentTask) return;
        total++;
        const targetCell = document.getElementById(`el-${currentTask.z}`);
        targetCell.classList.remove('content-hidden', 'target-frame', 'highlight');

        if (isCorrect) {
            score++;
            document.getElementById('feedback').innerText = "Richtig! ‚ú®";
            document.getElementById('feedback').style.color = "var(--success)";
            targetCell.classList.add('correct');
        } else {
            document.getElementById('feedback').innerText = `Leider falsch. Es war ${currentTask.n} (${currentTask.s}).`;
            document.getElementById('feedback').style.color = "var(--error)";
            targetCell.classList.add('wrong');
            if (clickedZ) document.getElementById(`el-${clickedZ}`).classList.add('wrong');
        }
        
        document.getElementById('score').innerText = score;
        document.getElementById('total').innerText = total;
        currentTask = null; // Aufgabe beendet, zeigt jetzt alles an (via updateVisibility)
        setTimeout(updateVisibility, 10); 
    }

    document.getElementById('submit-btn').onclick = () => {
        if (!currentTask) return;
        const val = document.getElementById('answer-input').value.trim().toLowerCase();
        const isCorrect = (val === currentTask.s.toLowerCase() || val === currentTask.n.toLowerCase());
        validate(isCorrect);
    };

    document.getElementById('answer-input').onkeypress = (e) => { if (e.key === 'Enter') document.getElementById('submit-btn').click(); };
    document.getElementById('next-btn').onclick = nextTask;
    document.getElementById('show-others').onchange = updateVisibility;
    document.getElementById('mode-select').onchange = () => { score=0; total=0; document.getElementById('score').innerText=0; document.getElementById('total').innerText=0; nextTask(); };

    initTable();
    refreshDeck();
</script>

</body>
</html>
